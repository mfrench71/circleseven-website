<!-- Individual Comment Item -->
{% assign comment_id = include.comment.id %}
{% assign post_slug = include.post_slug %}

<div class="comment" id="{{ comment_id }}" data-comment-id="{{ comment_id }}">
  <div class="comment-header">
    <img
      src="https://www.gravatar.com/avatar/{{ include.comment.email_hash }}?s=64&d=mp"
      alt="{{ include.comment.name }}"
      class="comment-avatar"
      loading="lazy"
    >
    <div class="comment-meta">
      <strong class="comment-author">{{ include.comment.name }}</strong>
      <time class="comment-date" datetime="{{ include.comment.date }}">
        {{ include.comment.date | date: "%B %-d, %Y at %-I:%M %p" }}
      </time>
    </div>
  </div>

  <div class="comment-body">
    {{ include.comment.message | newline_to_br }}
  </div>

  <!-- Nested Replies -->
  {% if site.data.comments[post_slug] %}
    {% assign replies = site.data.comments[post_slug] | where: "reply_to", comment_id | where: "approved", true %}
    {% if replies.size > 0 %}
      <div class="comment-replies">
        {% for reply in replies %}
          {% include comment-item.html comment=reply post_slug=post_slug %}
        {% endfor %}
      </div>
    {% endif %}
  {% endif %}
</div>

<style>
.comment {
  margin-bottom: 2rem;
  padding: 1.5rem;
  background: white;
  border: 1px solid #e8e8e8;
  border-radius: 8px;
}

.comment-header {
  display: flex;
  align-items: center;
  gap: 1rem;
  margin-bottom: 1rem;
}

.comment-avatar {
  width: 48px;
  height: 48px;
  border-radius: 50%;
  flex-shrink: 0;
}

.comment-meta {
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
}

.comment-author {
  color: #333;
  font-size: 1.rem;
}

.comment-date {
  color: #666;
  font-size: 0.875rem;
}

.comment-body {
  color: #444;
  line-height: 1.6;
  margin-left: 64px; /* Align with name */
}

.comment-replies {
  margin-top: 1.5rem;
  margin-left: 64px;
  padding-left: 1.5rem;
  border-left: 3px solid #e8e8e8;
}

.comment-replies .comment {
  background: #f9f9f9;
}

.comment-replies .comment-avatar {
  width: 40px;
  height: 40px;
}

@media (max-width: 600px) {
  .comment-body,
  .comment-replies {
    margin-left: 0;
  }

  .comment-header {
    flex-direction: column;
    align-items: flex-start;
  }
}
</style>
