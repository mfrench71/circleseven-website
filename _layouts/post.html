---
layout: default
---
{%- include breadcrumbs.html -%}

<article class="post h-entry" itemscope itemtype="https://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">{{ page.title | escape }}</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="{{ page.date | date_to_xmlschema }}" itemprop="datePublished">
        {{ page.date | date: "%b %-d, %Y" }}
      </time>
      {%- if page.author -%}
        • <span itemprop="author" itemscope itemtype="https://schema.org/Person"><span class="p-author h-card" itemprop="name">{{ page.author }}</span></span>
      {%- endif -%}
      • {%- include reading-time.html -%}
    </p>

    {%- comment -%} Featured image - automatically extracted from front matter or first image in content {%- endcomment -%}
    <div class="post-featured-image-wrapper">
      {%- include featured-image.html -%}
    </div>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    {{ content | auto_gallery }}
  </div>

  <div class="post-meta-footer">
    {%- if page.categories.size > 0 -%}
    <div class="post-categories-footer">
      <strong>Categories:</strong>
      {%- for category in page.categories -%}
        <a href="{{ site.baseurl }}/category/{{ category | slugify }}/" class="category-badge badge-{{ category | slugify }}">{{ category }}</a>
      {%- endfor -%}
    </div>
    {%- endif -%}

    {%- if page.tags.size > 0 -%}
    <div class="post-tags-footer">
      <strong>Tags:</strong>
      {%- for tag in page.tags -%}
        <a href="{{ site.baseurl }}/tag/{{ tag | slugify }}/" class="post-tag">{{ tag }}</a>
      {%- endfor -%}
    </div>
    {%- endif -%}
  </div>

  {%- comment -%}
  Smart Related Posts Algorithm:
  - Tier 1: Same category + matching tags (highest relevance)
  - Tier 2: Same category only (high relevance)
  - Tier 3: Matching tags only (medium relevance)
  Shows up to 3 posts, prioritizing higher tiers
  {%- endcomment -%}

  {%- assign tier1_posts = '' | split: '' -%}
  {%- assign tier2_posts = '' | split: '' -%}
  {%- assign tier3_posts = '' | split: '' -%}

  {%- for post in site.posts -%}
    {%- if post.url == page.url -%}
      {%- continue -%}
    {%- endif -%}

    {%- assign same_category = false -%}
    {%- assign has_common_tags = false -%}

    {%- comment -%} Check if same category {%- endcomment -%}
    {%- if post.categories.first == page.categories.first -%}
      {%- assign same_category = true -%}
    {%- endif -%}

    {%- comment -%} Check for common tags {%- endcomment -%}
    {%- for tag in post.tags -%}
      {%- if page.tags contains tag -%}
        {%- assign has_common_tags = true -%}
        {%- break -%}
      {%- endif -%}
    {%- endfor -%}

    {%- comment -%} Assign to appropriate tier {%- endcomment -%}
    {%- if same_category and has_common_tags -%}
      {%- assign tier1_posts = tier1_posts | push: post -%}
    {%- elsif same_category -%}
      {%- assign tier2_posts = tier2_posts | push: post -%}
    {%- elsif has_common_tags -%}
      {%- assign tier3_posts = tier3_posts | push: post -%}
    {%- endif -%}
  {%- endfor -%}

  {%- comment -%} Combine tiers, prioritizing tier 1, then 2, then 3 {%- endcomment -%}
  {%- assign related_posts = tier1_posts | concat: tier2_posts | concat: tier3_posts -%}

  {%- if related_posts.size > 0 -%}
  <aside class="related-posts">
    <h2>Related Posts</h2>
    <div class="post-grid">
      {%- for post in related_posts limit:3 -%}
      <article class="post-card">
        <!-- Card Image -->
        <div class="post-card-image">
          <a href="{{ post.url | relative_url }}">
            {%- include post-card-image.html post=post -%}
          </a>
        </div>

        <!-- Card Content -->
        <div class="post-card-content">
          <!-- Category Badge -->
          {%- if post.categories.size > 0 -%}
            {%- assign display_category = post.categories | last -%}
            <a href="{{ site.baseurl }}/category/{{ display_category | slugify }}/" class="category-badge badge-{{ display_category | slugify }}">
              {{ display_category }}
            </a>
          {%- endif -%}

          <!-- Title -->
          <h2 class="post-card-title">
            <a href="{{ post.url | relative_url }}">{{ post.title | escape }}</a>
          </h2>

          <!-- Excerpt -->
          {%- if post.excerpt -%}
            <p class="post-card-excerpt">{{ post.excerpt | strip_html | strip_newlines | truncatewords: 50 }}</p>
          {%- endif -%}

          <!-- Author & Meta -->
          <div class="post-card-meta">
            <img src="{%- include gravatar-url.html email=site.email size=64 -%}"
                 alt="{{ site.author | escape }}"
                 class="post-author-avatar"
                 loading="lazy"
                 onerror="this.src='{{ '/assets/images/default-avatar.svg' | relative_url }}'">
            <div class="post-meta-info">
              <span class="post-author-name">{{ site.author | escape }}</span>
              <span class="post-date-reading">
                <i class="far fa-calendar calendar-icon" aria-hidden="true"></i>
                {{ post.date | date: "%b %-d, %Y" }}
                {%- if post.content -%}
                  · {%- include reading-time.html -%}
                {%- endif -%}
              </span>
            </div>
          </div>
        </div>
      </article>
      {%- endfor -%}
    </div>
  </aside>
  {%- endif -%}

  <a class="u-url" href="{{ page.url | relative_url }}" hidden></a>
</article>
